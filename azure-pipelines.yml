trigger:
- develop

pool:
  vmImage: 'ubuntu-latest'

steps:
- script: dotnet tool install -g Wyam.Tool
  displayName: 'Install Wyam'

- script: |
    pushd src
    export PATH=$PATH:$HOME/.dotnet/tools
    wyam build
    echo ln -s output $(Build.ArtifactStagingDirectory)/linkedoutput
    ln -s output $(Build.ArtifactStagingDirectory)/linkedoutput
    popd
  displayName: 'Generate the static site'

- task: CopyFiles@2
  inputs:
    sourceFolder: $(Build.SourcesDirectory)/src/
    contents: 'output/**/*'
    targetFolder: $(Build.ArtifactStagingDirectory)
  displayName: 'Copy files to staging directory'

- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: $(Build.ArtifactStagingDirectory)/output
    artifactName: 'site'
    publishLocation: 'container'
  displayName: 'Publish site artifact'

- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: $(Build.ArtifactStagingDirectory)/linkedoutput
    artifactName: 'drop'
    publishLocation: 'container'
  displayName: 'Publish linked site artifact'

